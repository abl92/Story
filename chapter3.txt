This is the Chapter3. Modified in another branch.